#Python 正则表达式

##一、正则基础

正则：是一个特殊的字符序列，用于快速检索文本，实现查找、替换等操作

###（一）元字符

``\d``、`\D`：数字、非数字；等同于``[0-9]``

``\w``、``\W``：字符、非字符  ( 字母 ，数字，下划线 )；等同于``[A-Za-z0-9_]``

``\s``、``\S`` : 空白字符、非空白字符(空格、回车、制表符等)；等同于``[ \f\n\r\t\v]``

``\b``、``\B`` : 独立的部分   （ 起始，结束，空格 ）、非独立的部分

``.``：匹配除换行符 ``\n`` 外的其他所有字符

###（二）字符集、取反、范围

方括号，方括号内字符是或的关系，`^` 为取反，`-` 表范围

``"a[bc]d"``：匹配abd、acd

``"a[^bc]d"``：匹配除abd、acd外所有字符

``"a[x-z]b"``：匹配axb、ayb、azb

###（三）数量词

花括号，花括号内表示前一单个字符出现范围，默认采用贪婪模式，在满足条件范围内匹配最长字符串

``[a-z]{a,b}``：匹配任意a到b位字母的排列组合

``wzr*``：``*`` 前字符匹配0次或无限多次(wz/wzr/wzrr/wzrrr...)；等同于 ``wzr{0,}``

``wzr+``：``+`` 前字符至少出现1次(wzr/wzrr/wzrrr...)；等同于 ``wzr{1,}``

``wzr?``：``?`` 前字符出现0次或1次(wz/wzr)；等同于 ``wzr{0,1}``，"?" 是数量词

非贪婪模式：在花括号后加"?"，如 ``\w{3,6}?`` 则至多匹配三个字符，等同于 ``\w{3}``， "?" 是转换非贪婪模式的关键字

###（四）组

小括号，小括号内字符串表示一组，括号内文字相互是且的关系，并返回组内内容，默认正则整体是一个组

``(python){1,3}`` 表示字符串内重复出现1次至三次python

单次匹配时若存在组的嵌套则采用深度优先搜索顺序排列

```python
# 单一组
string1 = "111222333444"
print(re.findall("\d(\d)\d", string1))
# ['1', '2', '3', '4']

# 多个组
string2 = "11011220223303344044"
print(re.findall("\d(\d)0(\d)\d", string2))
# [('1', '1'), ('2', '2'), ('3', '3'), ('4', '4')]

# 嵌套组
string3 = "11011220223303344044"
print(re.findall("\d(\d(\d)\d)\d", string3))
# [('101', '0'), ('202', '0'), ('303', '0'), ('404', '0')]

# 嵌套混合组
string4 = "1181011228202233830334484044"
print(re.findall("\d((\d)8(\d))0(\d)\d", string4))
# [('181', '1', '1', '1'), ('282', '2', '2', '2'), ('383', '3', '3', '3'), ('484', '4', '4', '4')]
```

###（五）边界匹配符

`^` ：从字符串开始位置匹配

`$` ：从字符串末尾位置匹配

`^1\d{6}0350$` ：匹配尾号 "0350" 的手机号

###（六）python匹配模式参数（flags）

``re.I``：不区分大小写（同 ``re.IGNORECASE`` ）

``re.S``：让 ``.`` 元字符匹配所有字符，包括换行符 \n（同 ``re.DOTALL`` ）

``re.M``：多行模式匹配（同 ``re.MULTILINE`` ） ，如 ``^123`` 可匹配字符串 "121\n123"

``re.DEBUG``：显示编译时的debug信息

不同匹配模式参数之间用 "|" 连接

## 二、python正则表达式

python中引入正则模块：

```python
import re
```

## 1. re.findall

```python
re.findall(pattern, string, flags=0)
```

查找字符串，返回匹配列表

## 2. re.sub

```python
re.sub(pattern, repl/convert, string, count=0, flags=0)
```

字符串替换，返回替换后的字符串，其中 ``repl`` 为替换的字符串，也可以是 `convert` 变幻函数，`count` 为期望替换的次数

`convert(value)`  变幻函数内接收当前匹配对象 value，函数返回值为 `re.sub` 替换结果

```python
str_nums = "3627a949bbc0455js0537499py54171go152c++7854"

# 把字母替换为"|"：
print(re.sub('[a-z+]+', '|', str_nums))
# 3627|949|0455|0537499|54171|152|7854

# 把所有小于5的数字替换为0，大于5的数字替换为1：
def convert(value):
    return str(0 if int(value.group()) < 5 else 1)
print(re.sub('\d', convert, str_nums))
# 0101a101bbc0011js0101011py10010go010c++1110
```

## 3. re.match

```python
re.match(pattern, string, flags=0)
```

从首字母开始匹配，返回匹配结果对象，只会匹配一次，若没有匹配则返回 None

##4. re.search

```python
re.search(pattern, string, flags=0)
```

搜索整个字符串，直到找到满足条件的结果，只会匹配一次，返回匹配结果对象

## 5. group分组

`re.sub` 内替换函数中接收的参数和 `re.match`、`re.search` 返回查找对象为 `re.Match object` 格式

* **re_obj.span(i)**

返回第i个分组所在索引(tuple)，规则同序列切片

* **re_obj.group(i)**

取第i个分组内字符串，各组排序为照先后顺序和深度优先搜索顺序，默认取第0位(全部)；若存在多个数字则返回匹配字符元组(tuple)

```python
string = "1181011228202233830334484044"
print(re.findall("\d((\d)8(\d))0(\d)\d", string))
# [('181', '1', '1', '1'), ('282', '2', '2', '2'), ('383', '3', '3', '3'), ('484', '4', '4', '4')]

def convert(value):
    print(value.group(0, 1, 2), value.span(1))
    return "#"
print(re.sub('\d((\d)8(\d))0(\d)\d', convert, string))
# ('1181011', '181', '1') (1, 4)
# ('2282022', '282', '2') (8, 11)
# ('3383033', '383', '3') (15, 18)
# ('4484044', '484', '4') (22, 25)
# ####
```

